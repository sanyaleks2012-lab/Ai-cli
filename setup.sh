#!/data/data/com.termux/files/usr/bin/bash

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
REPO_ZIP_URL="https://github.com/–í–ê–®_–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨/–í–ê–®_–†–ï–ü–û–ó–ò–¢–û–†–ò–ô/archive/refs/heads/main.zip" # <<< –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–°–´–õ–ö–£!
WORKING_DIR="gemini-cli-assistant"
ZIP_FILE="repo.zip"
UNPACK_DIR=$(basename "$REPO_ZIP_URL" .zip)

echo "==========================================="
echo "  üöÄ –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ Gemini CLI-–ü–æ–º–æ—â–Ω–∏–∫–∞"
echo "==========================================="

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
echo -e "\n[1/4] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Termux-–ø–∞–∫–µ—Ç–æ–≤ (Python, Git, Wget, Unzip, TTS)..."
pkg update -y
pkg install python git python-pip wget unzip espeak -y

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
echo "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $WORKING_DIR..."
if [ -d "$WORKING_DIR" ]; then
    echo "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è $WORKING_DIR —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é..."
    rm -rf "$WORKING_DIR"
fi
mkdir "$WORKING_DIR"
cd "$WORKING_DIR"

# 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞
echo -e "\n[2/4] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å GitHub..."
wget -O "$ZIP_FILE" "$REPO_ZIP_URL"

echo "–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤..."
unzip -q "$ZIP_FILE"
rm "$ZIP_FILE"

# –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω—É—é
echo "–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é..."
if [ -d "$UNPACK_DIR" ]; then
    mv "$UNPACK_DIR"/* .
    rm -r "$UNPACK_DIR"
else
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –∏–º—è –ø–∞–ø–∫–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
    UNPACK_DIR=$(ls -d */ | head -n 1)
    if [ -n "$UNPACK_DIR" ]; then
        mv "$UNPACK_DIR"/* .
        rm -r "$UNPACK_DIR"
    fi
fi

# 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo -e "\n[3/4] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (requests, dotenv, colorama, tts)..."
pip install requests python-dotenv colorama pyttsx3

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .env
echo -e "\n[4/4] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ .env..."
if [ ! -f ".env" ]; then
    echo -e "\033[31;1m‚ö†Ô∏è –û—à–∏–±–∫–∞: –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∞—Ä—Ö–∏–≤–µ!\033[0m"
    echo "–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é —Å –∫–ª—é—á–æ–º API."
    exit 1
fi

# --- –§–ò–ù–ê–õ–¨–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò ---
echo -e "\n==========================================="
echo -e "\033[32;1m‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\033[0m"
echo "–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–∞, —Å–Ω–∞—á–∞–ª–∞:"
echo "1. \033[31;1m–í–∫–ª—é—á–∏—Ç–µ VPN/–ü—Ä–æ–∫—Å–∏\033[0m, –µ—Å–ª–∏ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –†–æ—Å—Å–∏–∏."
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–µ—Å–ª–∏ –≤—ã –Ω–µ –≤ –Ω–µ–π): \033[36;1mcd ~/$WORKING_DIR\033[0m"
echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:"
echo -e "\n\033[36;1mpython cli_assistant.py\033[0m"
echo "==========================================="